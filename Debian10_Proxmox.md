# Установка Proxmox на Debian Buster


Хостовый сервер должен иметь как минимум два, аналогичных по параметрам диска (HDD или SSD), для создания RAID массива. В случае с двумя дисками организовывается **программный** `raid1 mdadm`. Такая организация хранилища позволяет гибко подключать/отключать/менять диски. 

В связи с тем, что штатный инсталятор Proxmox PVE не дает возможности установить систему на программный RAID, потребуется сначала установить "чистую" Debian 10 на программный RAID (заодно можно поэксперементировать с извлечением/заменой дисков), а затем на установленную систему установить Proxmox.


## Шаг 1. Установка Debian Buster с созданием RAID.
Для установки Debian 10 достаточно воспользоваться CD-образом `netinst.iso` из официального репозитория. Либо можно использовать любой локальный проверенный репозиторий.

В случае использования локального репозитория, еще до этапа установки, рекомендуется сравнить актуальность хранящегося в нем архива, с официальным репозиторием.

На хостовый сервер Debian устанавливается в минимальной конфигурации без GUI. Требуются только `SSH server` и `standart system utilities`.

В ходе установки будет создан пользователь `root` с выбранным паролем и предложено создать еще одного пользователя с ограниченными правами. Рекомендуем это сделать, и именно под этим пользователем (например `user`) подключаться к серверу по SSH (т.к. в установках по умолчанию, в целях безопасности, подключение к серверу по SSH пользователя root, запрещено).

Как корректно установить Debian и организовать RAID, можно посмотреть, например здесь https://serveradmin.ru/kak-skachat-i-ustanovit-debian-10-buster/ или здесь https://serveradmin.ru/ustanovka-i-nastroyka-proxmox/


## Шаг 2. Настройка сети в  Debian Buster, настройка пользователей, SSH-подключений и hosts.
После установки системы и проверки корректности установленных драйверов на переферийное оборудование (в случае необходимости, придется самостоятельно искать и вручную доустанавливать драйвера для имеющейся переферии), следует настроить сетевое (сетевые) подключения для выбранной сети и sudo-доступ для пользователя `user`.

Затем следует откорректировать файл hosts. Для этого следует подключиться по SSH к настроенному серверу и отредактировать файл, приведя его к следующему виду:
``` bash
$ sudo vim /etc/hosts
```
напоминание: 
 - включение режима редактирования в vim: `a`
 - выход из vim: `Esc` + `:wq`

``` bash
127.0.0.1 localhost.localdomain localhost
172.16.200.10 proxmox6.local proxmox6 pvelocalhost
```
где:

proxmox6 | имя сервера, указанное во время установки
---|---
local | домен, указанный во время установки
172.16.200.10 | IP адрес сетевого интерфейса

проверить правильность установок можно командой:
``` bash
$ hostname --ip-address
```
в ответ должно вывести текущий IP.


## Шаг 3. Установка Proxmox
Добавляем в список репозиториев официальный репозиторий Proxmox и стандартные репозитории debian. В этом примере использованы оригинальные репозитории, все остальное можно закомментировать:
``` bash
$ sudo vim /etc/apt/sources.list
```
``` bash
deb http://mirror.corbina.net/debian/ buster main non-free contrib
deb-src http://mirror.corbina.net/debian/ buster main non-free contrib
deb http://download.proxmox.com/debian/pve buster pve-no-subscription
```
И добавляем цифровую подпись Proxmox репозитория:
``` bash
$ sudo wget http://download.proxmox.com/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg
```
Теперь следует обновить систему и перегрузить ее:
``` bash
$ sudo apt update -y && sudo apt full-upgrade
```
``` bash
$ sudo reboot
```
После перезагрузки устанавливаем систему виртуализации Proxmox:
``` bash
$ sudo apt install -y proxmox-ve postfix open-iscsi
```
Если получите ошибку после установки во время запуска службы `pve-cluster.service`, внимательно проверяйте на правильность файл hosts. В нем не должно быть никаких дополнительный строк (даже пустых).


